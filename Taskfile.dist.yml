version: '3.0'

tasks:
  build:
    cmd: dotnet run -- {{.CLI_ARGS}}
  run:with-build:
    cmds:
    - task: build
    - task: library:build
  library:build:
    dir: Alvao
    cmd: dotnet build .
  test:
    cmd: dotnet run -- test
  tidy:
    ignore_error: true
    aliases:
    - format
    generates:
    - html/*.htm
    sources:
    - html/*.htm
    cmd: tidy -config .tidyrc -f errors.txt -m html/*.htm*
  dotnet:run:
    cmd: dotnet run {{ .CLI_ARGS }}
  format:
    sources:
    - Program.cs
    - src/**
    - Alvao/**
    cmd: dotnet format
  clean:
    cmd: rm -rf Alvao/ Examples/
  restore:
    cmd: git checkout -- Examples/
  run:
    aliases:
    - default
    cmds:
    - task: clean
    - task: dotnet:run
    - task: tidy
    - task: format
    - task: restore
    - git add Alvao/
    - git add html/
    cmds:
      - task: delete
      - task: run
